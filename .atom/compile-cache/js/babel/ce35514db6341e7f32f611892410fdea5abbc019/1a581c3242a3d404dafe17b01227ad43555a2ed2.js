function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/* eslint-env jasmine */

var _temp = require('temp');

var _temp2 = _interopRequireDefault(_temp);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _fsPlus = require('fs-plus');

var _fsPlus2 = _interopRequireDefault(_fsPlus);

'use babel';

describe('gorename', function () {
  _temp2['default'].track();
  var mainModule = null;
  var gorename = null;
  var editor = null;
  var gopath = null;
  var oldGopath = null;
  var source = null;
  var target = null;

  beforeEach(function () {
    runs(function () {
      if (process.env.GOPATH) {
        oldGopath = process.env.GOPATH;
      }
      gopath = _fsPlus2['default'].realpathSync(_temp2['default'].mkdirSync('gopath-'));
      process.env.GOPATH = gopath;
    });

    waitsForPromise(function () {
      return atom.packages.activatePackage('environment').then(function () {
        return atom.packages.activatePackage('go-config');
      }).then(function () {
        return atom.packages.activatePackage('gorename');
      }).then(function (pack) {
        mainModule = pack.mainModule;
        gorename = mainModule.gorename;
        return;
      });
    });

    waitsFor(function () {
      return mainModule.getGoconfig() !== false;
    });
  });

  afterEach(function () {
    if (oldGopath) {
      process.env.GOPATH = oldGopath;
    } else {
      delete process.env.GOPATH;
    }
  });

  describe('when a simple file is open', function () {
    beforeEach(function () {
      runs(function () {
        source = _path2['default'].join(__dirname, 'fixtures', 'basic');
        target = _path2['default'].join(gopath, 'src', 'basic');
        _fsPlus2['default'].copySync(source, target);
      });

      waitsForPromise(function () {
        return atom.workspace.open(_path2['default'].join(target, 'main.go')).then(function (e) {
          editor = e;
          return;
        });
      });
    });

    it('renames a single token', function () {
      editor.setCursorBufferPosition([4, 5]);
      var info = gorename.wordAndOffset(editor);
      expect(info.word).toBe('foo');
      expect(info.offset).toBe(33);

      var file = editor.getBuffer().getPath();
      var cwd = _path2['default'].dirname(file);
      var r = false;
      var cmd = undefined;
      waitsForPromise(function () {
        return mainModule.getGoconfig().locator.findTool('gorename').then(function (c) {
          expect(c).toBeTruthy();
          cmd = c;
        });
      });
      waitsForPromise(function () {
        return gorename.runGorename(file, info.offset, cwd, 'bar', cmd).then(function (result) {
          r = result;
          return;
        });
      });
      runs(function () {
        expect(r).toBeTruthy();
        expect(r.success).toBe(true);
        expect(r.result.stdout.trim()).toBe('Renamed 2 occurrences in 1 file in 1 package.');
        var expected = _fsPlus2['default'].readFileSync(_path2['default'].join(__dirname, 'fixtures', 'basic-expected', 'main.go'), 'utf8');
        var actual = editor.getText();
        expect(actual).toBe(expected);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYW1lcy8uYXRvbS9wYWNrYWdlcy9nb3JlbmFtZS9zcGVjL2dvcmVuYW1lLXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztvQkFHaUIsTUFBTTs7OztvQkFDTixNQUFNOzs7O3NCQUNSLFNBQVM7Ozs7QUFMeEIsV0FBVyxDQUFBOztBQU9YLFFBQVEsQ0FBQyxVQUFVLEVBQUUsWUFBTTtBQUN6QixvQkFBSyxLQUFLLEVBQUUsQ0FBQTtBQUNaLE1BQUksVUFBVSxHQUFHLElBQUksQ0FBQTtBQUNyQixNQUFJLFFBQVEsR0FBRyxJQUFJLENBQUE7QUFDbkIsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFBO0FBQ2pCLE1BQUksTUFBTSxHQUFHLElBQUksQ0FBQTtBQUNqQixNQUFJLFNBQVMsR0FBRyxJQUFJLENBQUE7QUFDcEIsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFBO0FBQ2pCLE1BQUksTUFBTSxHQUFHLElBQUksQ0FBQTs7QUFFakIsWUFBVSxDQUFDLFlBQU07QUFDZixRQUFJLENBQUMsWUFBTTtBQUNULFVBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUU7QUFDdEIsaUJBQVMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQTtPQUMvQjtBQUNELFlBQU0sR0FBRyxvQkFBRyxZQUFZLENBQUMsa0JBQUssU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUE7QUFDbkQsYUFBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO0tBQzVCLENBQUMsQ0FBQTs7QUFFRixtQkFBZSxDQUFDLFlBQU07QUFDcEIsYUFBTyxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBTTtBQUM3RCxlQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxDQUFBO09BQ2xELENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBTTtBQUNaLGVBQU8s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LENBQUMsQ0FBQTtPQUNILENBQUMsQ0FBQTtBQUNGLFVBQUksQ0FBQyxZQUFNO0FBQ1QsY0FBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFBO0FBQ3RCLGNBQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQzVCLGNBQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQywrQ0FBK0MsQ0FBQyxDQUFBO0FBQ3BGLFlBQUksUUFBUSxHQUFHLG9CQUFHLFlBQVksQ0FBQyxrQkFBSyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQTtBQUNyRyxZQUFJLE1BQU0sR0FBRyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUE7QUFDN0IsY0FBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtPQUM5QixDQUFDLENBQUE7S0FDSCxDQUFDLENBQUE7R0FDSCxDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUEiLCJmaWxlIjoiL1VzZXJzL2phbWVzLy5hdG9tL3BhY2thZ2VzL2dvcmVuYW1lL3NwZWMvZ29yZW5hbWUtc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnXG4vKiBlc2xpbnQtZW52IGphc21pbmUgKi9cblxuaW1wb3J0IHRlbXAgZnJvbSAndGVtcCdcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgZnMgZnJvbSAnZnMtcGx1cydcblxuZGVzY3JpYmUoJ2dvcmVuYW1lJywgKCkgPT4ge1xuICB0ZW1wLnRyYWNrKClcbiAgbGV0IG1haW5Nb2R1bGUgPSBudWxsXG4gIGxldCBnb3JlbmFtZSA9IG51bGxcbiAgbGV0IGVkaXRvciA9IG51bGxcbiAgbGV0IGdvcGF0aCA9IG51bGxcbiAgbGV0IG9sZEdvcGF0aCA9IG51bGxcbiAgbGV0IHNvdXJjZSA9IG51bGxcbiAgbGV0IHRhcmdldCA9IG51bGxcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBydW5zKCgpID0+IHtcbiAgICAgIGlmIChwcm9jZXNzLmVudi5HT1BBVEgpIHtcbiAgICAgICAgb2xkR29wYXRoID0gcHJvY2Vzcy5lbnYuR09QQVRIXG4gICAgICB9XG4gICAgICBnb3BhdGggPSBmcy5yZWFscGF0aFN5bmModGVtcC5ta2RpclN5bmMoJ2dvcGF0aC0nKSlcbiAgICAgIHByb2Nlc3MuZW52LkdPUEFUSCA9IGdvcGF0aFxuICAgIH0pXG5cbiAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4ge1xuICAgICAgcmV0dXJuIGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdlbnZpcm9ubWVudCcpLnRoZW4oKCkgPT4ge1xuICAgICAgICByZXR1cm4gYXRvbS5wYWNrYWdlcy5hY3RpdmF0ZVBhY2thZ2UoJ2dvLWNvbmZpZycpXG4gICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdnb3JlbmFtZScpXG4gICAgICB9KS50aGVuKChwYWNrKSA9PiB7XG4gICAgICAgIG1haW5Nb2R1bGUgPSBwYWNrLm1haW5Nb2R1bGVcbiAgICAgICAgZ29yZW5hbWUgPSBtYWluTW9kdWxlLmdvcmVuYW1lXG4gICAgICAgIHJldHVyblxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgd2FpdHNGb3IoKCkgPT4ge1xuICAgICAgcmV0dXJuIG1haW5Nb2R1bGUuZ2V0R29jb25maWcoKSAhPT0gZmFsc2VcbiAgICB9KVxuICB9KVxuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgaWYgKG9sZEdvcGF0aCkge1xuICAgICAgcHJvY2Vzcy5lbnYuR09QQVRIID0gb2xkR29wYXRoXG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5HT1BBVEhcbiAgICB9XG4gIH0pXG5cbiAgZGVzY3JpYmUoJ3doZW4gYSBzaW1wbGUgZmlsZSBpcyBvcGVuJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgcnVucygoKSA9PiB7XG4gICAgICAgIHNvdXJjZSA9IHBhdGguam9pbihfX2Rpcm5hbWUsICdmaXh0dXJlcycsICdiYXNpYycpXG4gICAgICAgIHRhcmdldCA9IHBhdGguam9pbihnb3BhdGgsICdzcmMnLCAnYmFzaWMnKVxuICAgICAgICBmcy5jb3B5U3luYyhzb3VyY2UsIHRhcmdldClcbiAgICAgIH0pXG5cbiAgICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiB7XG4gICAgICAgIHJldHVybiBhdG9tLndvcmtzcGFjZS5vcGVuKHBhdGguam9pbih0YXJnZXQsICdtYWluLmdvJykpLnRoZW4oKGUpID0+IHtcbiAgICAgICAgICBlZGl0b3IgPSBlXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBpdCgncmVuYW1lcyBhIHNpbmdsZSB0b2tlbicsICgpID0+IHtcbiAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbNCwgNV0pXG4gICAgICBsZXQgaW5mbyA9IGdvcmVuYW1lLndvcmRBbmRPZmZzZXQoZWRpdG9yKVxuICAgICAgZXhwZWN0KGluZm8ud29yZCkudG9CZSgnZm9vJylcbiAgICAgIGV4cGVjdChpbmZvLm9mZnNldCkudG9CZSgzMylcblxuICAgICAgbGV0IGZpbGUgPSBlZGl0b3IuZ2V0QnVmZmVyKCkuZ2V0UGF0aCgpXG4gICAgICBsZXQgY3dkID0gcGF0aC5kaXJuYW1lKGZpbGUpXG4gICAgICBsZXQgciA9IGZhbHNlXG4gICAgICBsZXQgY21kXG4gICAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4ge1xuICAgICAgICByZXR1cm4gbWFpbk1vZHVsZS5nZXRHb2NvbmZpZygpLmxvY2F0b3IuZmluZFRvb2woJ2dvcmVuYW1lJykudGhlbigoYykgPT4ge1xuICAgICAgICAgIGV4cGVjdChjKS50b0JlVHJ1dGh5KClcbiAgICAgICAgICBjbWQgPSBjXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICAgd2FpdHNGb3JQcm9taXNlKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIGdvcmVuYW1lLnJ1bkdvcmVuYW1lKGZpbGUsIGluZm8ub2Zmc2V0LCBjd2QsICdiYXInLCBjbWQpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgIHIgPSByZXN1bHRcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgICBydW5zKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHIpLnRvQmVUcnV0aHkoKVxuICAgICAgICBleHBlY3Qoci5zdWNjZXNzKS50b0JlKHRydWUpXG4gICAgICAgIGV4cGVjdChyLnJlc3VsdC5zdGRvdXQudHJpbSgpKS50b0JlKCdSZW5hbWVkIDIgb2NjdXJyZW5jZXMgaW4gMSBmaWxlIGluIDEgcGFja2FnZS4nKVxuICAgICAgICBsZXQgZXhwZWN0ZWQgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKF9fZGlybmFtZSwgJ2ZpeHR1cmVzJywgJ2Jhc2ljLWV4cGVjdGVkJywgJ21haW4uZ28nKSwgJ3V0ZjgnKVxuICAgICAgICBsZXQgYWN0dWFsID0gZWRpdG9yLmdldFRleHQoKVxuICAgICAgICBleHBlY3QoYWN0dWFsKS50b0JlKGV4cGVjdGVkKVxuICAgICAgfSlcbiAgICB9KVxuICB9KVxufSlcbiJdfQ==
//# sourceURL=/Users/james/.atom/packages/gorename/spec/gorename-spec.js
